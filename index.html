<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Welcome to wxq&#39;s Blog created in 2017-01-01</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="Welcome to wxq&#39;s Blog created in 2017-01-01">
<meta property="og:url" content="http://www.digmyth.com/index.html">
<meta property="og:site_name" content="Welcome to wxq&#39;s Blog created in 2017-01-01">
<meta property="og:locale" content="zh-CN">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Welcome to wxq&#39;s Blog created in 2017-01-01">
  
    <link rel="alternate" href="/atom.xml" title="Welcome to wxq&#39;s Blog created in 2017-01-01" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  

</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Welcome to wxq&#39;s Blog created in 2017-01-01</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="搜索"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://www.digmyth.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-gitlab-install" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2021/11/20/gitlab-install/" class="article-date">
  <time datetime="2021-11-20T02:51:41.000Z" itemprop="datePublished">2021-11-20</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/CICD/">CICD</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2021/11/20/gitlab-install/">gitlab install</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>找到源，下载一个想要的版本即可<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">https://mirrors.bfsu.edu.cn/gitlab-ce/yum/el7/</span><br><span class="line">yum install https://mirrors.bfsu.edu.cn/gitlab-ce/yum/el7/gitlab-ce-14.5.0-ce.0.el7.x86_64.rpm</span><br></pre></td></tr></table></figure></p>
<p>修改配置文件,做好域名解析，禁用不必要的prometheus组件<br>vim  /etc/gitlab/gitlab.rb<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">external_url &apos;http://gitlab.do.com&apos;</span><br><span class="line">prometheus[&apos;enable&apos;] = false</span><br><span class="line">alertmanager[&apos;enable&apos;] = false</span><br><span class="line">node_exporter[&apos;enable&apos;] = false</span><br><span class="line">redis_exporter[&apos;enable&apos;] = false</span><br><span class="line">postgres_exporter[&apos;enable&apos;] = false</span><br><span class="line">gitlab_exporter[&apos;enable&apos;] =false</span><br><span class="line">grafana[&apos;enable&apos;] = false</span><br></pre></td></tr></table></figure></p>
<p>跟据配置安装各组件启动服务<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gitlab-ctl  reconfigure</span><br></pre></td></tr></table></figure></p>
<p>启动后运行的进程<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@node01 hello]# gitlab-ctl  status </span><br><span class="line">run: gitaly: (pid 15538) 2771s; run: log: (pid 13341) 2932s    </span><br><span class="line">run: gitlab-workhorse: (pid 15246) 2778s; run: log: (pid 14693) 2824s</span><br><span class="line">run: logrotate: (pid 13071) 2952s; run: log: (pid 13101) 2948s</span><br><span class="line">run: nginx: (pid 14772) 2819s; run: log: (pid 14809) 2817s  port  80/8060</span><br><span class="line">run: postgresql: (pid 13552) 2924s; run: log: (pid 13581) 2921s</span><br><span class="line">run: puma: (pid 12664) 266s; run: log: (pid 14527) 2836s</span><br><span class="line">run: redis: (pid 13205) 2941s; run: log: (pid 13236) 2938s</span><br><span class="line">run: sidekiq: (pid 12559) 274s; run: log: (pid 14610) 2830s</span><br></pre></td></tr></table></figure></p>
<p>占用端口明细,<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:9229  gitlab-workhorse</span><br><span class="line">127.0.0.1:9999  postgres</span><br><span class="line">::1:9999        postgres</span><br><span class="line">127.0.0.1:8080  puma 5.3.2</span><br><span class="line">0.0.0.0:80      nginx</span><br><span class="line">0.0.0.0:8060    nginx</span><br><span class="line">127.0.0.1:8082  sidekiq 6.2.2 </span><br><span class="line">127.0.0.1:9236  gitaly</span><br></pre></td></tr></table></figure></p>
<p>备份恢复<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@node01 ~]# gitlab-backup    create</span><br><span class="line">[root@node01 ~]# gitlab-backup    restore</span><br></pre></td></tr></table></figure></p>
<p>同项目组协同开发</p>
<ul>
<li>同公司或同部门内部开发一个项目时，项目内成员拥有读写权限.</li>
<li>那么就要在此项目下邀请成员，并邀请时给定角色为Maintainer才可推送成功</li>
</ul>
<p>跨公司协同开发</p>
<ul>
<li>跨公司协作时不能邀请为成员，权限过大，此时采用另一种方式Fork.</li>
<li>三方成员账号下访问给定项目，并Fork到自己远程仓库里，那么三方成员对自己仓库代码拥有读写权限.</li>
<li>待开发完成，再访问原有项目，在原有项目上发起Merge Request或Pull request,意思是请求把自己仓库下的代码合并到项目上，等管理员批准并合并代码完成协同开发。</li>
</ul>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>学习</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://www.digmyth.com/2021/11/20/gitlab-install/" data-id="ckwg44x6o001a7cjxomukf2eq" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  

  
</article>



  
    <article id="post-jenkins-install" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2021/11/19/jenkins-install/" class="article-date">
  <time datetime="2021-11-19T02:51:41.000Z" itemprop="datePublished">2021-11-19</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/CICD/">CICD</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2021/11/19/jenkins-install/">jenkins install</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>清华源自行安装<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">https://mirrors.bfsu.edu.cn/jenkins/redhat-stable/</span><br><span class="line">yum install  https://mirrors.bfsu.edu.cn/jenkins/redhat-stable/jenkins-2.303.3-1.1.noarch.rpm</span><br></pre></td></tr></table></figure></p>
<p>修改配置文件/etc/sysconfig/jenkins<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[root@jenkins ~]# cat /etc/sysconfig/jenkins  | grep -v ^# | grep -v ^$</span><br><span class="line">JENKINS_HOME=&quot;/var/lib/jenkins&quot;</span><br><span class="line">JENKINS_JAVA_CMD=&quot;&quot;</span><br><span class="line">JENKINS_USER=&quot;jenkins&quot;</span><br><span class="line">JENKINS_JAVA_OPTIONS=&quot;-Djava.awt.headless=true&quot;</span><br><span class="line">JENKINS_PORT=&quot;5081&quot;   # 不要冲突</span><br><span class="line">JENKINS_LISTEN_ADDRESS=&quot;&quot;</span><br><span class="line">JENKINS_HTTPS_PORT=&quot;&quot;</span><br><span class="line">JENKINS_HTTPS_KEYSTORE=&quot;&quot;</span><br><span class="line">JENKINS_HTTPS_KEYSTORE_PASSWORD=&quot;&quot;</span><br><span class="line">JENKINS_HTTPS_LISTEN_ADDRESS=&quot;&quot;</span><br><span class="line">JENKINS_HTTP2_PORT=&quot;&quot;</span><br><span class="line">JENKINS_HTTP2_LISTEN_ADDRESS=&quot;&quot;</span><br><span class="line">JENKINS_DEBUG_LEVEL=&quot;5&quot;</span><br><span class="line">JENKINS_ENABLE_ACCESS_LOG=&quot;no&quot;</span><br><span class="line">JENKINS_HANDLER_MAX=&quot;100&quot;</span><br><span class="line">JENKINS_HANDLER_IDLE=&quot;20&quot;</span><br><span class="line">JENKINS_EXTRA_LIB_FOLDER=&quot;&quot;</span><br><span class="line">JENKINS_ARGS=&quot;&quot;</span><br></pre></td></tr></table></figure></p>
<p>启动服务<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@jenkins ~]# systemctl  start jenkins</span><br></pre></td></tr></table></figure></p>
<p>或者直接下载jar包直接启动</p>
<p>或者官方yum安装<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">wget -O /etc/yum.repos.d/jenkins.repo \</span><br><span class="line">    https://pkg.jenkins.io/redhat-stable/jenkins.repo</span><br><span class="line">rpm --import https://pkg.jenkins.io/redhat-stable/jenkins.io.key</span><br><span class="line">yum upgrade</span><br><span class="line">yum install epel-release java-11-openjdk-devel</span><br><span class="line">yum install jenkins</span><br><span class="line">systemctl daemon-reload</span><br></pre></td></tr></table></figure></p>
<p>如果安装插件比较慢，可以更新update.json文件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost jenkins]# sed -i  &apos;s@https://updates.jenkins.io/download/@https://mirrors.bfsu.edu.cn/jenkins/@g&apos; updates/default.json </span><br><span class="line">[root@localhost jenkins]# sed -i  &apos;s@https://updates.jenkins.io/update-center.json@https://mirrors.bfsu.edu.cn/jenkins/updates/update-center.json@i&apos; hudson.model.UpdateCenter.xml</span><br></pre></td></tr></table></figure></p>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>学习</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://www.digmyth.com/2021/11/19/jenkins-install/" data-id="ckwg44x6x001l7cjx8qzh3stc" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  

  
</article>



  
    <article id="post-jenkins_mvn" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2021/10/25/jenkins_mvn/" class="article-date">
  <time datetime="2021-10-25T00:48:04.000Z" itemprop="datePublished">2021-10-25</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/CICD/">CICD</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2021/10/25/jenkins_mvn/">jenkins容器里安装maven</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        The article has been encrypted, please enter your password to view.<br>
        
          <p class="article-more-link">
            <a href="/2021/10/25/jenkins_mvn/#more">Read More</a>
          </p>
        
      
    </div>
    <footer class="article-footer">
      <a data-url="http://www.digmyth.com/2021/10/25/jenkins_mvn/" data-id="ckwg44x6y001m7cjxu0zqm9zi" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  

  
</article>



  
    <article id="post-linux-note个人小记" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2021/10/15/linux-note个人小记/" class="article-date">
  <time datetime="2021-10-15T01:32:54.000Z" itemprop="datePublished">2021-10-15</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Linux/">Linux</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2021/10/15/linux-note个人小记/">linux个人小记</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bridge fdb  add  $mac dev $ethx</span><br></pre></td></tr></table></figure>
<p>执行命令 cat /proc/buddyinfo 查看 slab，系统不存在大块内存时返回0数量较多<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /proc/buddyinfo</span><br></pre></td></tr></table></figure></p>
<p>周期性地或者在发现大块内存不足时，先进行 drop_cache 操作<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo 3 &gt; /proc/sys/vm/drop_caches</span><br></pre></td></tr></table></figure></p>
<p>必要时执行以下操作进行内存整理<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo 1 &gt; /proc/sys/vm/compact_memory</span><br></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">执行命令 atop ，查看当前磁盘 IO 状态</span><br><span class="line">磁盘 sda 显示 busy 100% ，表示已达到严重性能瓶颈，继续在该界面按 d，可查看哪些进程正在使用磁盘 IO</span><br><span class="line">iotop -oPa查看哪些进程占用磁盘 IO</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://www.digmyth.com/2021/10/15/linux-note个人小记/" data-id="ckwg44x8e003h7cjxydfzhsyi" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  

  
</article>



  
    <article id="post-harbor-install" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2021/08/20/harbor-install/" class="article-date">
  <time datetime="2021-08-20T02:51:41.000Z" itemprop="datePublished">2021-08-20</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/CICD/">CICD</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2021/08/20/harbor-install/">harbor install</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="一-基本安装过程"><a href="#一-基本安装过程" class="headerlink" title="一. 基本安装过程"></a>一. 基本安装过程</h3><p>下载离线harbor Tar包<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">https://github.com/goharbor/harbor/</span><br><span class="line">https://github.com/goharbor/harbor/releases/download/v2.3.4/harbor-offline-installer-v2.3.4.tgz</span><br></pre></td></tr></table></figure></p>
<p>解压后进入主目录<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp harbor.yml.tmpl harbor.yml</span><br></pre></td></tr></table></figure></p>
<p>编辑几个参数<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">hostname: harbor.do.com</span><br><span class="line">http:</span><br><span class="line">  port: 5080</span><br><span class="line">https:</span><br><span class="line">  port: 443</span><br><span class="line">  certificate: /opt/harbor/certs/harbor.do.com.crt</span><br><span class="line">  private_key: /opt/harbor/certs/harbor.do.com.key </span><br><span class="line">harbor_admin_password: admin</span><br><span class="line">data_volume: /data</span><br></pre></td></tr></table></figure></p>
<p>安装<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@harbor harbor]# rm  -rf /data</span><br><span class="line">[root@harbor harbor]# ./prepare </span><br><span class="line">[root@harbor harbor]# ./install.sh </span><br><span class="line">[root@harbor harbor]# docker-compose  down -v</span><br><span class="line">[root@harbor harbor]# docker-compose  up -d</span><br></pre></td></tr></table></figure></p>
<p>证书docker目录下也保留一份用于认证到harbor<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@harbor harbor]# ls /etc/docker/certs.d/harbor.do.com/</span><br><span class="line">ca.crt  harbor.do.com.cert  harbor.do.com.key</span><br></pre></td></tr></table></figure></p>
<h3 id="二-证书细节"><a href="#二-证书细节" class="headerlink" title="二. 证书细节"></a>二. 证书细节</h3><p>如果有https证书的需求，需要额外几个步骤制作证书，这里记录说明.</p>
<p>harbor证书需要一个SAN/alternative_NAME的证书扩展的玩意，一般的openssl证书还不行，严格按照官网来.</p>
<ol>
<li><p>生成CA key.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl genrsa -out ca.key 4096</span><br></pre></td></tr></table></figure>
</li>
<li><p>自签CA证书</p>
</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl req -x509 -new -nodes -sha512 -days 3650 -subj &quot;/C=CN/ST=Beijing/L=Beijing/O=example/OU=Personal/CN=harbor.done.com&quot; -key ca.key -out ca.crt</span><br></pre></td></tr></table></figure>
<ol start="3">
<li><p>生成服务器key</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl genrsa -out harbor.done.com.key 4096</span><br></pre></td></tr></table></figure>
</li>
<li><p>生成服务器csr</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl req -sha512 -new -subj &quot;/C=CN/ST=Beijing/L=Beijing/O=example/OU=Personal/CN=harbor.done.com&quot; -key harbor.done.com.key  -out harbor.done.com.csr</span><br></pre></td></tr></table></figure>
</li>
<li><p>生成v3的玩意儿</p>
</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">cat &gt; v3.ext &lt;&lt;-EOF</span><br><span class="line">authorityKeyIdentifier=keyid,issuer</span><br><span class="line">basicConstraints=CA:FALSE</span><br><span class="line">keyUsage = digitalSignature, nonRepudiation, keyEncipherment, dataEncipherment</span><br><span class="line">extendedKeyUsage = serverAuth</span><br><span class="line">subjectAltName = @alt_names</span><br><span class="line"></span><br><span class="line">[alt_names]</span><br><span class="line">DNS.1=harbor.done.com</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>
<ol start="6">
<li><p>签发服务器证书</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl x509 -req -sha512 -days 3650     -extfile v3.ext     -CA ca.crt -CAkey ca.key -CAcreateserial -in harbor.done.com.csr -out harbor.done.com.crt</span><br></pre></td></tr></table></figure>
</li>
<li><p>证书转换<br>放置docker端docker会认crt为CA证书，cert为客户端证书，所以不能直接放harbor.done.com.crt</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl x509 -inform PEM -in harbor.done.com.crt -out  harbor.done.com.cert</span><br></pre></td></tr></table></figure>
</li>
<li><p>使用证书<br>harbor程序使用</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">https:</span><br><span class="line">  # https port for harbor, default is 443</span><br><span class="line">  port: 443</span><br><span class="line">  # The path of cert and key files for nginx</span><br><span class="line">  certificate: /opt/harbor/certs/harbor.done.com.crt</span><br><span class="line">  private_key: /opt/harbor/certs/harbor.done.com.key</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>docker Daemon使用<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">root@node:~# ll /etc/docker/certs.d/harbor.done.com/</span><br><span class="line">total 20</span><br><span class="line">-rw------- 1 root root 2037 Nov 26 03:49 ca.crt</span><br><span class="line">-rw------- 1 root root 2074 Nov 26 03:49 harbor.done.com.cert</span><br><span class="line">-rw------- 1 root root 3243 Nov 26 03:49 harbor.done.com.key</span><br></pre></td></tr></table></figure></p>
<h4 id="三-k8s-secret"><a href="#三-k8s-secret" class="headerlink" title="三. k8s secret"></a>三. k8s secret</h4><p>除每个k8s node节点/etc/docker/certs/harbor.do.com/下保存证书外，如果harbor创建的仓库是私有仓库，那么k8s拉镜像时还是需要用户名密码保存在secret的.</p>
<p>创建secret<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">kubectl create secret docker-registry regcred \</span><br><span class="line">  --docker-server=harbor.done.com  \</span><br><span class="line">  --docker-username=xx  \</span><br><span class="line">  --docker-password=xx  -n testns</span><br></pre></td></tr></table></figure></p>
<p>deployment引用<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">apiVersion: apps/v1</span><br><span class="line">kind: Deployment</span><br><span class="line">metadata:</span><br><span class="line">  name: demo</span><br><span class="line">  namespace: testns</span><br><span class="line">spec:</span><br><span class="line">  replicas: 1</span><br><span class="line">  selector:</span><br><span class="line">    matchLabels:</span><br><span class="line">      workload.user.cattle.io/workloadselector: apps.deployment-testns-demo</span><br><span class="line">  template:</span><br><span class="line">    metadata:</span><br><span class="line">      labels:</span><br><span class="line">        workload.user.cattle.io/workloadselector: apps.deployment-testns-demo</span><br><span class="line">    spec:</span><br><span class="line">      affinity: &#123;&#125;</span><br><span class="line">      containers:</span><br><span class="line">      - image: harbor.done.com/dev/spring:v1</span><br><span class="line">        imagePullPolicy: Always</span><br><span class="line">        name: container-x</span><br><span class="line">        ports:</span><br><span class="line">        - containerPort: 80</span><br><span class="line">          name: port80</span><br><span class="line">          protocol: TCP</span><br><span class="line">        resources: &#123;&#125;</span><br><span class="line">      imagePullSecrets:</span><br><span class="line">      - name: regcred</span><br><span class="line">      restartPolicy: Always</span><br></pre></td></tr></table></figure></p>
<p>###四. 验证<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">URL    https://harbor.do.com</span><br><span class="line">docker login harbor.do.com</span><br></pre></td></tr></table></figure></p>
<h3 id="五-总结"><a href="#五-总结" class="headerlink" title="五. 总结"></a>五. 总结</h3><p>参考：<a href="https://goharbor.io/docs/2.4.0/install-config/configure-https/" target="_blank" rel="noopener">https://goharbor.io/docs/2.4.0/install-config/configure-https/</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://www.digmyth.com/2021/08/20/harbor-install/" data-id="ckwg44x6u001h7cjx1syilnon" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  

  
</article>



  
    <article id="post-linux-lvm-migrate" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2021/08/15/linux-lvm-migrate/" class="article-date">
  <time datetime="2021-08-15T13:12:30.000Z" itemprop="datePublished">2021-08-15</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Linux/">Linux</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2021/08/15/linux-lvm-migrate/">LVM 换盘</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>背景： 多个LUN划给主机做成LVM卷，现在要更换后端LUN，也就是更换集中存储设备，业务端涉及虚机上千就不从虚机端拷贝数据了，直接从LVM物理卷更换</p>
<p>模拟线上操作，添加2G * 2块盘做为LVM卷，第三块盘为新添加，替换掉第一块盘，保证LV卷数据不丢失</p>
<p>扫盘<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">for  i in $(find /sys -iname &apos;scan&apos;); do echo &quot;- - -&quot; &gt; $i; done</span><br></pre></td></tr></table></figure></p>
<p>裸盘分区<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">parted /dev/sdb  -s -- mklabel gpt mkpart primary 1 100%</span><br><span class="line">parted /dev/sdc  -s -- mklabel gpt mkpart primary 1 100%</span><br><span class="line">parted /dev/sdd  -s -- mklabel gpt mkpart primary 1 100%</span><br></pre></td></tr></table></figure></p>
<p>制作PV<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pvcreate  /dev/sdb  /dev/sdc</span><br></pre></td></tr></table></figure></p>
<p>制作VG<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vgcreate vg001 /dev/sdb  /dev/sdc</span><br></pre></td></tr></table></figure></p>
<p>划分LV, 有意划分3G大小卷跨物理PV<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lvcreate -L 3G -n lv001 vg001</span><br></pre></td></tr></table></figure></p>
<p>查看物理PE信息<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pvdisplay</span><br></pre></td></tr></table></figure></p>
<p>查看VG信息<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vgdisplay</span><br></pre></td></tr></table></figure></p>
<p>卷写入数据<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># mkfs.ext4 /dev/mapper/vg001-lv001</span><br><span class="line"># mount /dev/mapper/vg001-lv001  /data</span><br><span class="line"># echo &quot;test lvm data&quot; &gt; /data/test.txt</span><br></pre></td></tr></table></figure></p>
<p>添加第三块到VG<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vgextend  vg001 /dev/sdd</span><br></pre></td></tr></table></figure></p>
<p>移除第一块盘中的PE<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pvmove /dev/sdb</span><br></pre></td></tr></table></figure></p>
<p>从VG中移除第一块盘<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vgreduce  vg001 /dev/sdb</span><br></pre></td></tr></table></figure></p>
<p>最后移除PV<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pvremove /dev/sdb</span><br></pre></td></tr></table></figure></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://www.digmyth.com/2021/08/15/linux-lvm-migrate/" data-id="ckwg44x8300397cjx8ro3y5jg" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  

  
</article>



  
    <article id="post-mysql-HA" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2021/08/09/mysql-HA/" class="article-date">
  <time datetime="2021-08-09T00:41:54.000Z" itemprop="datePublished">2021-08-09</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Mysql/">Mysql</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2021/08/09/mysql-HA/">Mysql高可用集群</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        The article has been encrypted, please enter your password to view.<br>
        
          <p class="article-more-link">
            <a href="/2021/08/09/mysql-HA/#more">Read More</a>
          </p>
        
      
    </div>
    <footer class="article-footer">
      <a data-url="http://www.digmyth.com/2021/08/09/mysql-HA/" data-id="ckwg44x9i004l7cjxlewwwwpw" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  

  
</article>



  
    <article id="post-mysql-MGR-02模式切换" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2021/08/09/mysql-MGR-02模式切换/" class="article-date">
  <time datetime="2021-08-08T21:45:54.000Z" itemprop="datePublished">2021-08-09</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Mysql/">Mysql</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2021/08/09/mysql-MGR-02模式切换/">MySQL MGR单主多主模式切换</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <ul>
<li>目录</li>
</ul>
<p>模式查看<br>group_replication_single_primary_mode=1表示当前为单主模式，强一致检查group_replication_enforce_update_everywhere_checks属于关闭状态<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select @@group_replication_single_primary_mode,@@group_replication_enforce_update_everywhere_checks;</span><br><span class="line">+-----------------------------------------+------------------------------------------------------+</span><br><span class="line">| @@group_replication_single_primary_mode | @@group_replication_enforce_update_everywhere_checks |</span><br><span class="line">+-----------------------------------------+------------------------------------------------------+</span><br><span class="line">|                                       1 |                                                    0 |</span><br><span class="line">+-----------------------------------------+------------------------------------------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure></p>
<p>节点角色查询<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT * FROM performance_schema.replication_group_members;</span><br><span class="line">+---------------------------+--------------------------------------+-------------+-------------+--------------+-------------+----------------+----------------------------+</span><br><span class="line">| CHANNEL_NAME              | MEMBER_ID                            | MEMBER_HOST | MEMBER_PORT | MEMBER_STATE | MEMBER_ROLE | MEMBER_VERSION | MEMBER_COMMUNICATION_STACK |</span><br><span class="line">+---------------------------+--------------------------------------+-------------+-------------+--------------+-------------+----------------+----------------------------+</span><br><span class="line">| group_replication_applier | 2cc80a03-363f-11ec-9bdd-000c295cfe4c | sql02       |        3306 | ONLINE       | PRIMARY     | 8.0.27         | XCom                       |</span><br><span class="line">| group_replication_applier | 78563b4c-21b6-11ec-a7f5-7bc466af3c1e | sql01       |        3306 | ONLINE       | SECONDARY   | 8.0.27         | XCom                       |</span><br><span class="line">+---------------------------+--------------------------------------+-------------+-------------+--------------+-------------+----------------+----------------------------+</span><br><span class="line">2 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure></p>
<p>切换为多主<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select group_replication_switch_to_multi_primary_mode();</span><br><span class="line">+--------------------------------------------------+</span><br><span class="line">| group_replication_switch_to_multi_primary_mode() |</span><br><span class="line">+--------------------------------------------------+</span><br><span class="line">| Mode switched to multi-primary successfully.     |</span><br><span class="line">+--------------------------------------------------+</span><br><span class="line">1 row in set (1.07 sec)</span><br></pre></td></tr></table></figure></p>
<p>多主模式下要求强一致性，所以group_replication_enforce_update_everywhere_checks=1<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select @@group_replication_single_primary_mode,@@group_replication_enforce_update_everywhere_checks;</span><br><span class="line">+-----------------------------------------+------------------------------------------------------+</span><br><span class="line">| @@group_replication_single_primary_mode | @@group_replication_enforce_update_everywhere_checks |</span><br><span class="line">+-----------------------------------------+------------------------------------------------------+</span><br><span class="line">|                                       0 |                                                    1 |</span><br><span class="line">+-----------------------------------------+------------------------------------------------------+</span><br><span class="line">1 row in set (0.00 sec)</span><br></pre></td></tr></table></figure></p>
<p>切换为单主，同时指定主节点UUID<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select group_replication_switch_to_single_primary_mode(&apos;78563b4c-21b6-11ec-a7f5-7bc466af3c1e&apos;);</span><br><span class="line">+---------------------------------------------------+</span><br><span class="line">| group_replication_switch_to_single_primary_mode() |</span><br><span class="line">+---------------------------------------------------+</span><br><span class="line">| Mode switched to single-primary successfully.     |</span><br><span class="line">+---------------------------------------------------+</span><br><span class="line">1 row in set (0.05 sec)</span><br></pre></td></tr></table></figure></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://www.digmyth.com/2021/08/09/mysql-MGR-02模式切换/" data-id="ckwg44x9n004o7cjxdwme7pro" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  

  
</article>



  
    <article id="post-prometheus-relabel" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2021/07/25/prometheus-relabel/" class="article-date">
  <time datetime="2021-07-24T21:48:08.000Z" itemprop="datePublished">2021-07-25</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Prometheus/">Prometheus</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2021/07/25/prometheus-relabel/">prometheus 重新打标</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>定义在job字段内<br>示例1<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"># A scrape configuration containing exactly one endpoint to scrape:</span><br><span class="line"># Here it&apos;s Prometheus itself.</span><br><span class="line">scrape_configs:</span><br><span class="line">  # The job name is added as a label `job=&lt;job_name&gt;` to any timeseries scraped from this config.</span><br><span class="line">  - job_name: &apos;prometheus&apos;</span><br><span class="line"></span><br><span class="line">    # metrics_path defaults to &apos;/metrics&apos;</span><br><span class="line">    # scheme defaults to &apos;http&apos;.</span><br><span class="line"></span><br><span class="line">    consul_sd_configs:</span><br><span class="line">    - server: &quot;192.168.1.40:8500&quot;</span><br><span class="line">      tags:</span><br><span class="line">      - &quot;prometheus&quot;</span><br><span class="line">      refresh_interval: 2m </span><br><span class="line"></span><br><span class="line">  # All nodes</span><br><span class="line">  - job_name: &apos;nodes&apos;</span><br><span class="line">    consul_sd_configs:</span><br><span class="line">    - server: &quot;192.168.1.40:8500&quot;</span><br><span class="line">      tags:</span><br><span class="line">      - &quot;nodes&quot;</span><br><span class="line">      refresh_interval: 2m </span><br><span class="line"></span><br><span class="line">    relabel_configs:</span><br><span class="line">    - source_labels:</span><br><span class="line">      - __scheme__</span><br><span class="line">      - __address__</span><br><span class="line">      - __metrics_path__</span><br><span class="line">      regex: &quot;(http|https)(.*)&quot;</span><br><span class="line">      separator: &quot;&quot;</span><br><span class="line">      target_label: &quot;endpoint&quot; # 添加标记，值为replacement内容</span><br><span class="line">      replacement: &quot;$&#123;1&#125;://$&#123;2&#125;&quot;</span><br><span class="line">      action: replace</span><br><span class="line"></span><br><span class="line">    metric_relabel_configs:   # 删除指标</span><br><span class="line">    #- source_labels:</span><br><span class="line">    #  - __name__</span><br><span class="line">    #  regex: &quot;go_info.*&quot;</span><br><span class="line">    #  action: drop</span><br><span class="line">   # metric_relabel_configs:</span><br><span class="line">    - source_labels:</span><br><span class="line">      - __name__</span><br><span class="line">      regex: &quot;salar.*&quot;</span><br><span class="line">      action: drop</span><br></pre></td></tr></table></figure></p>
<p>示例2<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"># Here it&apos;s Prometheus itself.</span><br><span class="line">scrape_configs:</span><br><span class="line">  # The job name is added as a label `job=&lt;job_name&gt;` to any timeseries scraped from this config.</span><br><span class="line">  - job_name: &apos;nodes&apos;</span><br><span class="line">    file_sd_configs:</span><br><span class="line">    - files:</span><br><span class="line">      - targets/nodes-*.yaml</span><br><span class="line">      refresh_interval: 1m</span><br><span class="line">  </span><br><span class="line">    relable_configs:</span><br><span class="line">    - regex: &quot;(app)&quot;</span><br><span class="line">      replacement: &quot;$&#123;1&#125;_name&quot;  # 重命名为xxx_name</span><br><span class="line">      action: labelmap   # 标签名的重命名</span><br><span class="line"></span><br><span class="line">    - regex: &quot;(app)&quot;   #删除app这个标签 </span><br><span class="line">      action: labeldrop</span><br></pre></td></tr></table></figure></p>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>drop:  正则匹配成功就删除<br>keep:  正则匹配成功就保留</p>
<p>relabel_configs:<br>  抓取前的标记，针对target自身标记，将来自服务发现的元数据标签中的信息附加到指标上标签上和过滤目标的作用</p>
<p>metric_relabel_configs:<br>  抓取后的标记，针对抓取指标的标记，用于删除指标、从指标中删除标签、添加编辑修改指标的值</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://www.digmyth.com/2021/07/25/prometheus-relabel/" data-id="ckwg44xab005e7cjx16loeogm" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  

  
</article>



  
    <article id="post-PostgreSQL-快速入门" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2021/07/20/PostgreSQL-快速入门/" class="article-date">
  <time datetime="2021-07-20T00:41:54.000Z" itemprop="datePublished">2021-07-20</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/PostgreSQL/">PostgreSQL</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2021/07/20/PostgreSQL-快速入门/">PostgreSQL快速入门</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        The article has been encrypted, please enter your password to view.<br>
        
          <p class="article-more-link">
            <a href="/2021/07/20/PostgreSQL-快速入门/#more">Read More</a>
          </p>
        
      
    </div>
    <footer class="article-footer">
      <a data-url="http://www.digmyth.com/2021/07/20/PostgreSQL-快速入门/" data-id="ckwg44x5u000d7cjxxdprgm6f" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  

  
</article>



  


  <nav id="page-nav">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><span class="space">&hellip;</span><a class="page-number" href="/page/15/">15</a><a class="extend next" rel="next" href="/page/2/">__('next') &raquo;</a>
  </nav>
</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">分类</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/CICD/">CICD</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Ceph/">Ceph</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Git/">Git</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Linux/">Linux</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Mongodb/">Mongodb</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Mysql/">Mysql</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Openstack/">Openstack</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/PostgreSQL/">PostgreSQL</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Prometheus/">Prometheus</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python/">Python</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Shell/">Shell</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/WebDjango开发/">WebDjango开发</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/WebFlask开发/">WebFlask开发</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/WebSocket/">WebSocket</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Web爬虫开发/">Web爬虫开发</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/ansible/">ansible</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/声明/">声明</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/大数据/">大数据</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/容器世界/">容器世界</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/日志系统/">日志系统</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/生活/">生活</a></li></ul>
    </div>
  </div>


  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">归档</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/11/">十一月 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/10/">十月 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/08/">八月 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/07/">七月 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/06/">六月 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/05/">五月 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/04/">四月 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/03/">三月 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/02/">二月 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/01/">一月 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/12/">十二月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/09/">九月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/07/">七月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/03/">三月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/02/">二月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/01/">一月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/12/">十二月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/11/">十一月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/10/">十月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/09/">九月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/08/">八月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/07/">七月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/06/">六月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/02/">二月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/01/">一月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/12/">十二月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/11/">十一月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/10/">十月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/08/">八月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/07/">七月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/06/">六月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/05/">五月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/01/">一月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/12/">十二月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/11/">十一月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/10/">十月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/09/">九月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/08/">八月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/07/">七月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/06/">六月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/05/">五月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/04/">四月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">三月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/02/">二月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/01/">一月 2017</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">最新文章</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2021/11/20/gitlab-install/">gitlab install</a>
          </li>
        
          <li>
            <a href="/2021/11/19/jenkins-install/">jenkins install</a>
          </li>
        
          <li>
            <a href="/2021/10/25/jenkins_mvn/">jenkins容器里安装maven</a>
          </li>
        
          <li>
            <a href="/2021/10/15/linux-note个人小记/">linux个人小记</a>
          </li>
        
          <li>
            <a href="/2021/08/20/harbor-install/">harbor install</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2021 wxq<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<!--
<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
-->

<script src="https://cdn.bootcss.com/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>